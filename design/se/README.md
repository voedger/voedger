# Standart Edition (SE)

TOC

- [Principles](#principles)
- [Nodes & Swarm Services](#nodes--swarm-services)
- [grafana Service](#grafana-service)

## Principles

- Node must be a clean Ubuntu node
  - Reason: We believe it will avoid possible conflicts between installed software and reduce operation costs
- Balancer (e.g.  https://www.hetzner.com/cloud/load-balancer) should be used for redirecting traffic to the voedger containers
- Edger is not used (though its functionality is similar to what we need to maintain cluster nodes)
  - Reason: Edger requires connection to working Application which does not exist yet
- Orchestrator: swarm
  - Every node is a manager


## Nodes & Swarm Services

```mermaid
  flowchart TD

  SECluster{{SE Cluster}}:::H
  AppNode1("app-node-1"):::H
  AppNode2("app-node-2"):::H
  DBNode1("db-node-1"):::H
  DBNode2("db-node-2"):::H
  DBNode3("db-node-3"):::H

  DockerSwarm:::G
  subgraph DockerSwarm["Docker Swarm"]
    SEDockerStack:::G
    
    subgraph SEDockerStack
      voedger:::S
    end

    MonDockerStack("Monitoring Docker Stack"):::G
    subgraph MonDockerStack
      prometheus("prometheus1,2"):::S
      alertmanager("alertmanager1,2"):::S
      graphana("graphana1,2"):::S
    end

    DBDockerStack("DB Docker Stack"):::G
    subgraph DBDockerStack
      scylla("scylla1,2,3"):::S
    end
  end

  SECluster --- AppNode1
  SECluster --- AppNode2
  SECluster --- DBNode1
  SECluster --- DBNode2
  SECluster --- DBNode3

  AppNode1 --- SEDockerStack
  AppNode2 --- SEDockerStack
  AppNode1 --- MonDockerStack
  AppNode2 --- MonDockerStack

  DBNode1 --- DBDockerStack
  DBNode2 --- DBDockerStack
  DBNode3 --- DBDockerStack


  classDef G fill:#FFFFFF,stroke:#000000, stroke-width:1px, stroke-dasharray: 5 5
  classDef B fill:#FFFFB5,color:#333
  classDef S fill:#B5FFFF
  classDef H fill:#C9E7B7
```

## grafana Service

Principles

- User: grafana
- Password: generated by ctool
  `ctool grafana getpwd`
  `ctool grafana newpwd`


```mermaid
flowchart TD

  User("grafana"):::B

  balancer80("cluster-domain:80/grafana"):::G
  balancer433("cluster-domain::433/grafana"):::G
  voedger433(":433/grafana"):::G
  voedger80(":80/grafana"):::G
  voedger433(":433/grafana"):::G
  LoadBalancer("LoadBalancer (by Cloud Provider)"):::H

  User --> balancer80
  User --> balancer433
  balancer80 -->LoadBalancer:::H
  balancer433 -->LoadBalancer:::H

  LoadBalancer --> AppNode1:::H
  LoadBalancer --> AppNode2:::H
  AppNode1 --> voedger80
  AppNode1 --> voedger433
  AppNode2 --> voedger80
  AppNode2 --> voedger433

  voedger80 --> voedger:::S
  voedger433 --> voedger:::S

  voedger --> localhost:3000:::G
  localhost:3000 --> grafana1:::S
  localhost:3000 --> grafana2:::S

  grafana1 --> prometheus1:::S
  grafana2 --> prometheus2:::S

  classDef G fill:#FFFFFF,stroke:#000000, stroke-width:1px, stroke-dasharray: 5 5
  classDef B fill:#FFFFB5,color:#333
  classDef S fill:#B5FFFF
  classDef H fill:#C9E7B7
```
